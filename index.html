<!DOCTYPE html>
<html lang="kr">

<head>
	<title>SSG EDITOR</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

</head>
<body bgcolor="gray">

	<div class="left" style="position:absolute;float:left;left:20%;">
		<p style="color:white; font-size:50px; font-weight:bold;">
			SSG TITLER
		</p>
		<p>
			TEXT
			<input type="text" id="textInput" value="" size=12 style="line-height: 25px;font-size:18px;padding:3px">
			<button onclick="myText()" style="color:white; background:#000080; font-size:18px; line-height: 25px; padding:3px 30px">입력</button>
			<p>
				<p>
					<p>
						<p>
							<p>
								● 서체&nbsp;&nbsp;&nbsp;
								<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="1">1</button>
								<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="2">2</button>
								<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">3</button>

								<p>
									● 굵기&nbsp;&nbsp;&nbsp;
									<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">1</button>
									<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">2</button>
									<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">3</button>

									<p>
										● 시선&nbsp;&nbsp;&nbsp;
										<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">1</button>
										<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">2</button>
										<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">3</button>

										<p>
											● 칼라&nbsp;&nbsp;&nbsp;
											<button onclick="" style="line-height: 18px;font-size:18px;color:red;background:red" size="3">1</button>
											<button onclick="" style="line-height: 18px;font-size:18px;color:orange;background:orange" size="3">2</button>
											<button onclick="" style="line-height: 18px;font-size:18px;color:yellow;background:yellow" size="3">3</button>
											<button onclick="" style="line-height: 18px;font-size:18px;color:greenyellow;background:greenyellow" size="3">4</button>
											<button onclick="" style="line-height: 18px;font-size:18px;color:green;background:green" size="3">5</button>
											<button onclick="" style="line-height: 18px;font-size:18px;color:aqua;background:aqua" size="3">6</button>
											<button onclick="" style="line-height: 18px;font-size:18px;color:blue;background:blue" size="3">7</button>
											<button onclick="" style="line-height: 18px;font-size:18px;color:purple;background:purple" size="3">8</button>
											<button onclick="" style="line-height: 18px;font-size:18px;color:brown;background:brown" size="3">9</button>
											<button onclick="" style="line-height: 18px;font-size:18px;color:gray;background:gray" size="3">0</button>

											<p>
												● 액션&nbsp;&nbsp;&nbsp;
												<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">1</button>
												<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">2</button>
												<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">3</button>
												<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">4</button>
												<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">5</button>
												<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">6</button>

												<p>
													● 이펙트
													<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">1</button>
													<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">2</button>
													<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">3</button>
													<button onclick="" style="color:white; background:dimgray; line-height: 18px;font-size:18px" size="3">4</button>

													<p>
														<p>
															<button onclick="" style="line-height: 18px;font-size:18px; color: white;background:gray;padding:3px 30px" size="3">취 소</button>
															<button onclick="" style="line-height: 18px;font-size:18px; color: white;background:gray;padding:5px 40px" size="3">확 인</button>
															<p>

																<span class="button" id="color">change color</span>,
																<span class="button" id="font">change font</span>,
																<span class="button" id="weight">change weight</span>
																<!-- <span class="button" id="bevel">change bevel</span><p> -->
	</div>
			<script src="js/RecordRTC.js"></script>
			<script src="js/screenshot.js"></script>
			<script src="build/three.js"></script>
			<script src="js/GeometryUtils.js"></script>
			<script src="js/WebGL.js"></script>
			<script src="js/stats.min.js"></script>

			<canvas id="myCanvas" style="position:absolute;left: 100; border:1px solid #c3c3c3;"></canvas>
			<!-- <canvas style="float:left;"></canvas>
			<canvas style="float:left;"></canvas> -->
			<script>
			var canvas = document.getElementById("myCanvas");

				if (WEBGL.isWebGLAvailable() === false) {
					document.body.appendChild(WEBGL.getWebGLErrorMessage());
				}
				// myText();
				THREE.Cache.enabled = true;
				var container, stats, permalink, hex;
				var camera, cameraTarget, scene, renderer;
				var group, textMesh1, textMesh2, textGeo, materials;
				var firstLetter = false;
				var text = "",
					height = 20,
					size = 70,
					hover = 30,
					curveSegments = 4,
					bevelThickness = 2,
					bevelSize = 1.5,
					bevelEnabled = true,
					font = undefined,
					fontName = "NanumGothic", // helvetiker, optimer, gentilis, droid sans, droid serif
					fontWeight = "Bold"; // normal bold

				var mirror = true;
				var fontMap = {
					"NanumGothic": 0,
					"NanumMyeongjo": 1,
					"BMHANNAPro": 2
					// "gentilis": 2,
					// "droid/droid_sans": 3,
					// "droid/droid_serif": 4
				};

				var weightMap = {
					"Regular": 0,
					"Bold": 1
				};
				var reverseFontMap = [];
				var reverseWeightMap = [];
				for (var i in fontMap) reverseFontMap[fontMap[i]] = i;
				for (var i in weightMap) reverseWeightMap[weightMap[i]] = i;
				var targetRotation = 0;
				var targetRotationOnMouseDown = 0;
				var windowHalfX = window.innerWidth / 2;
				var fontIndex = 1;
				init();
				animate();

				function decimalToHex(d) {
					var hex = Number(d).toString(16);
					hex = "000000".substr(0, 6 - hex.length) + hex;
					return hex.toUpperCase();
				}

				function init() {
					container = document.createElement('div');
					document.body.appendChild(container);

					// CAMERA
					camera = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight, 1, 1500);
					camera.position.set(0, 400, 700);
					cameraTarget = new THREE.Vector3(0, 150, 0);

					// SCENE
					scene = new THREE.Scene();
					scene.background = new THREE.Color(0x000000);
					scene.fog = new THREE.Fog(0x000000, 250, 1400);

					// LIGHTS
					var dirLight = new THREE.DirectionalLight(0xffffff, 0.125);
					dirLight.position.set(0, 0, 1).normalize();
					scene.add(dirLight);
					var pointLight = new THREE.PointLight(0xffffff, 1.5);
					pointLight.position.set(0, 100, 90);
					scene.add(pointLight);

					// Get text from hash
					var hash = document.location.hash.substr(1);

					if (hash.length !== 0) {
						var colorhash = hash.substring(0, 6);
						var fonthash = hash.substring(0, 2);
						var weighthash = hash.substring(7, 8);
						var bevelhash = hash.substring(8, 9);
						var texthash = hash.substring(10);
						hex = colorhash;
						pointLight.color.setHex(parseInt(colorhash, 16));
						fontName = reverseFontMap[parseInt(fonthash)];
						fontWeight = reverseWeightMap[parseInt(weighthash)];
						bevelEnabled = parseInt(bevelhash);
						// text = decodeURI( texthash );
						text = "";
					} else {
						pointLight.color.setHSL(Math.random(), 1, 0.5);
						hex = decimalToHex(pointLight.color.getHex());
					}

					materials = [
						new THREE.MeshPhongMaterial({
							color: 0xffffff,
							flatShading: true
						}), // front
						new THREE.MeshPhongMaterial({
							color: 0xffffff
						}) // side
					];

					group = new THREE.Group();
					group.position.y = 100;

					scene.add(group);

					loadFont();

					var plane = new THREE.Mesh(
						new THREE.PlaneBufferGeometry(10000, 10000),
						new THREE.MeshBasicMaterial({
							color: 0xffffff,
							opacity: 0.5,
							transparent: true
						})
					);
					plane.position.y = 100;
					plane.rotation.x = -Math.PI / 2;
					scene.add(plane);

					// RENDERER
					renderer = new THREE.WebGLRenderer({
						antialias: true
					});
					renderer.setPixelRatio(window.devicePixelRatio);
					renderer.setSize(window.innerWidth / 3, window.innerHeight / 3); //original size
					container.appendChild(renderer.domElement);

					// STATS
					stats = new Stats();
					document.getElementById("color").addEventListener('click', function() {
						pointLight.color.setHSL(Math.random(), 1, 0.5);
						hex = decimalToHex(pointLight.color.getHex());
					}, false);
					document.getElementById("font").addEventListener('click', function() {
						fontIndex++;
						fontName = reverseFontMap[fontIndex % reverseFontMap.length];
						loadFont();
					}, false);
					document.getElementById("weight").addEventListener('click', function() {

						if (fontWeight === "Bold") {
							fontWeight = "Regular";
						} else {
							fontWeight = "Bold";
						}
						loadFont();
					}, false);

					//soft
					// document.getElementById( "bevel" ).addEventListener( 'click', function () {
					// 	bevelEnabled = ! bevelEnabled;
					// 	refreshText();
					// }, false );
					//soft

					window.addEventListener('resize', onWindowResize, false);
				}

				function onWindowResize() {
					windowHalfX = window.innerWidth / 2;
					camera.aspect = window.innerWidth / window.innerHeight;
					camera.updateProjectionMatrix();
					renderer.setSize(window.innerWidth / 3, window.innerHeight / 3); //resizeing

				}

				function boolToNum(b) {
					return b ? 1 : 0;
				}

				function myText() {
					text = document.getElementById("textInput").value;
					refreshText();
				}

				function loadFont() {
					var loader = new THREE.FontLoader();
					loader.load('fonts/' + fontName + '_' + fontWeight + '.typeface.json', function(response) {
						font = response;
						refreshText();
					});
				}

				function createText() {
					textGeo = new THREE.TextGeometry(text, {
						font: font,
						size: size,
						height: height,
						curveSegments: curveSegments,

						bevelThickness: bevelThickness,
						bevelSize: bevelSize,
						bevelEnabled: bevelEnabled
					});
					textGeo.computeBoundingBox();
					textGeo.computeVertexNormals();

					if (!bevelEnabled) {
						var triangleAreaHeuristics = 0.1 * (height * size);
						for (var i = 0; i < textGeo.faces.length; i++) {
							var face = textGeo.faces[i];
							if (face.materialIndex == 1) {
								for (var j = 0; j < face.vertexNormals.length; j++) {
									face.vertexNormals[j].z = 0;
									face.vertexNormals[j].normalize();
								}
								var va = textGeo.vertices[face.a];
								var vb = textGeo.vertices[face.b];
								var vc = textGeo.vertices[face.c];
								var s = THREE.GeometryUtils.triangleArea(va, vb, vc);

								if (s > triangleAreaHeuristics) {
									for (var j = 0; j < face.vertexNormals.length; j++) {
										face.vertexNormals[j].copy(face.normal);
									}
								}
							}
						}
					}

					var centerOffset = -0.5 * (textGeo.boundingBox.max.x - textGeo.boundingBox.min.x);
					textGeo = new THREE.BufferGeometry().fromGeometry(textGeo);
					textMesh1 = new THREE.Mesh(textGeo, materials);
					textMesh1.position.x = centerOffset;
					textMesh1.position.y = hover;
					textMesh1.position.z = 0;
					textMesh1.rotation.x = 0;
					textMesh1.rotation.y = Math.PI * 2;
					group.add(textMesh1);

					// if ( mirror ) {
					// 	textMesh2 = new THREE.Mesh( textGeo, materials );
					// 	textMesh2.position.x = centerOffset;
					// 	textMesh2.position.y = - hover;
					// 	textMesh2.position.z = height;
					// 	textMesh2.rotation.x = Math.PI;
					// 	textMesh2.rotation.y = Math.PI * 2;
					// 	group.add( textMesh2 );
					// }
				}

				function refreshText() {
					group.remove(textMesh1);
					if (mirror) group.remove(textMesh2);
					if (!text) return;
					createText();
				}

				function animate() {
					requestAnimationFrame(animate);
					render();
					stats.update();
				}

				function render() {
					var rotation = 0.01;
					// var rotation = document.getElementById("speed").value*0.001;
					group.rotation.y += rotation; //회전속도
					camera.lookAt(cameraTarget);
					renderer.clear();
					renderer.render(scene, camera);
				}
			</script>

			<script type="text/javascript">
				/* JAVASCRIPT CODE for video */
				var elementToShare = document.querySelector('canvas');
				var recorder = RecordRTC(elementToShare, {
					type: 'canvas',
					showMousePointer: true
				});

				document.getElementById('startRecording').onclick = function() {
					this.disabled = true;

					isRecordingStarted = true;
					isStoppedRecording = false;
					recorder.startRecording();

					document.getElementById('stopRecording').disabled = false;
				};

				document.getElementById('stopRecording').onclick = function() {
					this.disabled = true;

					isStoppedRecording = true;
					recorder.stopRecording(function(url) {
						var blob = recorder.getBlob();
						console.log('blob', blob);

						var video = document.createElement('video');
						video.src = URL.createObjectURL(blob);
						video.setAttribute('style', 'height: 100%; position: absolute; top:0;');
						var body = document.querySelector('body');
						body.innerHTML = 'result';
						body.appendChild(video);
						video.controls = true;
						video.play();
					});
				};
			</script>

			<button onclick="" style="line-height: 18px;font-size:18px; color: white;background:red;padding:8px 60px" size="3">저 장</button>
</body>

</html>
